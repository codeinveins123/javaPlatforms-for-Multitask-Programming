# СРС2: Многопоточный загрузчик файлов
студент 3ьего курса Васильев Даниил Евгеньевич

## 1. Название проекта и описание
**Многопоточный загрузчик файлов с поддержкой докачки**

Программа представляет собой консольное приложение для загрузки файлов из интернета с использованием многопоточности. Основные возможности:
- Параллельная загрузка нескольких файлов
- Разбиение файлов на чанки для ускорения загрузки
- Валидация загруженных файлов
- Отображение прогресса загрузки
- Поддержка возобновления прерванных загрузок

## 2. Использованные технологии
- **Язык программирования**: Java 11+
- **Параллелизм**:
  - `ExecutorService` для управления пулами потоков
  - `ConcurrentHashMap` для потокобезопасного хранения прогресса загрузки
  - `CountDownLatch` для синхронизации потоков
  - `BlockingQueue` для очереди загрузки файлов
- **Библиотеки**:
  - Стандартная библиотека Java (java.net, java.io, java.util.concurrent)
  - Java Logging API для логирования

## 3. Требования для запуска
- **JDK 11** или выше
- Доступ в интернет для загрузки файлов
- Минимальные системные требования:
  - 512 МБ оперативной памяти
  - 100 МБ свободного места на диске

## 4. Инструкция по компиляции и запуску

### Компиляция:
```bash
javac -d bin -cp src src/kz/kaznu/course/iws2/*.java
```

### Запуск:
```bash
java -cp bin kz.kaznu.course.iws2.Main [опции] URL1 [URL2 ...]
```

### Доступные опции:
- `--output <папка>`: Указание папки для загрузки (по умолчанию: 'Download')
- `--parallel <число>`: Максимальное количество одновременных загрузок (по умолчанию: 2)
- `--chunk-threads <число>`: Количество потоков для загрузки одного файла (по умолчанию: 4)
- `--chunk-size <размер>`: Размер чанка в МБ (по умолчанию: 1 МБ)
- `--log`: Включение логирования
- `--help`: Показать справку

## 5. Примеры использования

### Загрузка одного файла:
```bash
java -cp bin kz.kaznu.course.iws2.Main https://example.com/largefile.zip
```

### Загрузка нескольких файлов с настройками:
```bash
java -cp bin kz.kaznu.course.iws2.Main \
    --files https://example.com/file1.zip \
    https://example.com/file2.iso \
    --output Downloads \
    --parallel 3 \
    --chunk-threads 4 \
    --chunk-size 2 \
```

## 6. Архитектура решения

### Основные компоненты:
1. **DownloadManager**
   - Управляет очередью загрузок
   - Создает и контролирует рабочие потоки
   - Управляет настройками загрузки

2. **FileDownloader**
   - Отвечает за загрузку одного файла
   - Разбивает файл на чанки
   - Управляет потоками для загрузки чанков

3. **ChunkDownloader**
   - Загружает отдельный чанк файла
   - Поддерживает докачку при обрыве соединения

4. **ProgressTracker**
   - Отслеживает прогресс загрузки
   - Формирует статистику

5. **FileValidator**
   - Проверяет целостность загруженных файлов
   - Сравнивает контрольные суммы

6. **TUI (Text User Interface)**
   - Отображает прогресс загрузки

### Поток работы:
1. Пользователь запускает программу с параметрами
2. DownloadManager инициализирует очередь загрузок
3. Для каждого URL создается задача загрузки (DownloadTask)
4. Рабочие потоки берут задачи из очереди
5. FileDownloader разбивает файл на чанки
6. ChunkDownloader'ы загружают чанки параллельно
7. После загрузки всех чанков файл собирается и валидируется
8. Прогресс отображается в консоли

## 7. Особенности реализации

### Параллельная загрузка
- Используется `ExecutorService` с фиксированным пулом потоков
- Каждый файл загружается в отдельном потоке
- Чанки файла загружаются параллельно

### Синхронизация
- `ConcurrentHashMap` для хранения прогресса загрузки
- `CountDownLatch` для ожидания завершения загрузки всех чанков
- Синхронизированные блоки для доступа к общим ресурсам

### Валидация
- Проверка размера файла
- Сравнение контрольных сумм (если доступно)
- Восстановление при ошибках

### Оптимизации
- Буферизация ввода-вывода
- Настраиваемый размер чанков
- Кэширование соединений
- Повторные попытки при сбоях

## 8. Пример вывода программы

```
==========================================
         МЕНЕДЖЕР ЗАГРУЗКИ ФАЙЛОВ
==========================================

[1] hw_200.csv
    Прогресс: 100,0% (3,6 KB/3,6 KB) 0,00 MB/s - Завершено    
    Размер: OK | Хеш(SHA-256): 77bc857c153bcd5e...

[2] rI1ed9.jpg
    Прогресс: 100,0% (174,6 KB/174,6 KB) 0,01 MB/s - Завершено
    Размер: OK | Хеш(SHA-256): 0d47ffa335b651ce...

[3] hw_25000.csv
    Прогресс: 100,0% (618,5 KB/618,5 KB) 0,04 MB/s - Завершено
    Размер: OK | Хеш(SHA-256): 9fa10991664bf95e...

[4] ElephantsDream.mp4
    Прогресс: 23,0% (37,2 MB/161,8 MB) 2,77 MB/s - Загрузка...

[5] bGUmIh.png
    Прогресс: 100,0% (598,2 KB/598,2 KB) 0,04 MB/s - Завершено
    Размер: OK | Хеш(SHA-256): 83dd598f57057cc8...

==========================================
Нажмите Ctrl+C для остановки
```

## 8.1 Пример логирования

```
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.Main main
INFO: Начинаем загрузку 1 файлов
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager setEnableLogging
INFO: Логирование включено для DownloadManager
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager addDownload
INFO: Добавлен загрузчик для файла: hw_200.csv из https://people.sc.fsu.edu/~jburkardt/data/csv/hw_200.csv
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.Main main
INFO: Добавлена задача на загрузку: https://people.sc.fsu.edu/~jburkardt/data/csv/hw_200.csv
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager startDownloads
INFO: Начинаем загрузку. Файлов: 1
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager startDownloads
INFO: Параллельных загрузок: 2
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager startDownloads
INFO: Потоков на файл: 4
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager startDownloads
INFO: Размер чанка: 1 MB
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.DownloadManager downloadFile
INFO: Начинается загрузка: https://people.sc.fsu.edu/~jburkardt/data/csv/hw_200.csv
дек. 09, 2025 2:34:36 AM kz.kaznu.course.iws2.FileDownloader downloadFile
INFO: Начинаем загрузку файла: hw_200.csv из https://people.sc.fsu.edu/~jburkardt/data/csv/hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.FileDownloader downloadFile
INFO: Размер файла hw_200.csv: 3734 байт
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.FileDownloader downloadFile
INFO: Используем 1 потоков для загрузки файла hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.ChunkDownloader download
INFO: Начинаем многопоточную загрузку файла hw_200.csv с использованием 1 потоков
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.ChunkDownloader download
INFO: Все потоки завершили загрузку чанков для файла hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.ChunkDownloader mergeChunks
INFO: Объединяем чанки в файл: Download\hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.ChunkDownloader mergeChunks
INFO: Файл успешно объединен: Download\hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.ChunkDownloader cleanupTempFiles
INFO: Очищаем временные файлы для hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.ChunkDownloader cleanupTempFiles
INFO: Очищено 1 временных файлов для hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.FileDownloader downloadFile
INFO: Файл hw_200.csv успешно загружен
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.DownloadManager downloadFile
INFO: Загрузка успешна: hw_200.csv
дек. 09, 2025 2:34:38 AM kz.kaznu.course.iws2.DownloadManager downloadFile
INFO: Валидация успешна для файла: hw_200.csv | Размер: 3734 | Хеш: 77bc857c153bcd5e...
```

## 9. Известные ограничения
- Нет поддержки загрузки по FTP
- Ограниченная поддержка HTTPS (только стандартные сертификаты)
- Максимальный размер файла ограничен доступной памятью
- Нет встроенного планировщика загрузок

## 10. Возможные улучшения
- Добавление графического интерфейса
- Поддержка закачки по расписанию
- Интеграция с облачными хранилищами
- Улучшенная обработка ошибок сети
- Поддержка прокси-серверов


я устал босс...